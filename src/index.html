<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0d1b2a">
<meta name="description" content="A creative sensory canvas with ambient sound">
<title>Calm Station</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.svg">

<!-- Google Fonts: DM Sans -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

<link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- Loading Splash -->
<div id="splash" class="splash">
  <div class="splash-circle"></div>
  <div class="splash-title">Calm Station</div>
</div>

<!-- Ambient background canvas (behind profile screen) -->
<canvas id="ambient-canvas"></canvas>

<!-- Screen: Profile Selection -->
<div id="screen-profiles" class="screen active">
  <div class="profiles-header">
    <h1>Calm Station</h1>
  </div>
  <div class="profiles-grid">
    <!-- JS renders profile cards here -->
  </div>
</div>

<!-- Screen: Canvas -->
<div id="screen-canvas" class="screen">
  <canvas id="main-canvas"></canvas>
  <div class="canvas-ui">
    <button id="btn-back" aria-label="Back to profiles">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <button id="btn-clear" aria-label="Clear canvas">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path d="M4 4L16 16M16 4L4 16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
    </button>
    <button id="btn-sound" aria-label="Sound options">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path d="M10 3v14M6 6v8M14 6v8M2 8v4M18 8v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
    </button>
    <!-- Sound Panel -->
    <div id="sound-panel" class="sound-panel">
      <div class="sound-options" id="sound-options">
        <!-- JS renders sound option buttons -->
      </div>
      <div class="sound-controls">
        <button id="btn-play-pause" class="btn-play-pause" aria-label="Play/Pause">
          <svg id="icon-play" width="18" height="18" viewBox="0 0 18 18" fill="none">
            <path d="M4 2.5L15 9L4 15.5Z" fill="currentColor"/>
          </svg>
          <svg id="icon-pause" width="18" height="18" viewBox="0 0 18 18" fill="none" style="display:none">
            <rect x="3" y="2" width="4" height="14" rx="1" fill="currentColor"/>
            <rect x="11" y="2" width="4" height="14" rx="1" fill="currentColor"/>
          </svg>
        </button>
        <input type="range" id="volume-slider" class="volume-slider" min="0" max="100" value="50" aria-label="Volume">
      </div>
    </div>
    <div id="mode-indicator" class="mode-indicator" aria-live="polite"></div>
    <!-- Gentle Prompt Orb -->
    <div id="gentle-orb" class="gentle-orb" role="button" aria-label="Try a calming exercise"></div>
    <!-- Prompt Choice (Breathe / Ground) -->
    <div id="prompt-choice" class="prompt-choice">
      <button class="prompt-btn" data-exercise="breathe">Breathe</button>
      <button class="prompt-btn" data-exercise="ground">Ground</button>
    </div>
  </div>
  <!-- Breathing Exercise Overlay -->
  <div id="breathe-overlay" class="exercise-overlay">
    <button id="breathe-close" class="exercise-close" aria-label="Close">&times;</button>
    <div class="breathe-pattern-picker" id="breathe-patterns">
      <!-- JS renders pattern buttons -->
    </div>
    <div class="breathe-circle-wrap">
      <div id="breathe-circle" class="breathe-circle"></div>
      <div id="breathe-label" class="breathe-label"></div>
    </div>
    <div id="breathe-counter" class="breathe-counter"></div>
    <button id="breathe-start" class="breathe-start-btn">Start</button>
    <button id="breathe-skip" class="breathe-skip">Skip</button>
  </div>
  <!-- Grounding Exercise Overlay -->
  <div id="ground-overlay" class="exercise-overlay">
    <button id="ground-close" class="exercise-close" aria-label="Close">&times;</button>
    <div id="ground-progress" class="ground-progress">
      <!-- JS renders 5 progress bars -->
    </div>
    <div id="ground-sense-icon" class="ground-sense-icon"></div>
    <h3 id="ground-sense-title" class="ground-sense-title"></h3>
    <p id="ground-sense-prompt" class="ground-sense-prompt"></p>
    <div id="ground-circles" class="ground-circles">
      <!-- JS renders tap circles -->
    </div>
    <button id="ground-next" class="ground-next-btn" disabled>Next</button>
    <button id="ground-skip-btn" class="breathe-skip">Skip</button>
  </div>
  <!-- Energy Check-In Overlay -->
  <div id="energy-checkin" class="exercise-overlay energy-overlay">
    <button id="energy-checkin-close" class="exercise-close" aria-label="Close">&times;</button>
    <p class="energy-question">Where's your energy right now?</p>
    <div id="energy-checkin-levels" class="energy-levels">
      <!-- JS renders 5 levels -->
    </div>
    <button id="energy-checkin-go" class="energy-go-btn" disabled>Let's start</button>
  </div>
  <!-- Energy Check-Out Overlay -->
  <div id="energy-checkout" class="exercise-overlay energy-overlay">
    <button id="energy-checkout-close" class="exercise-close" aria-label="Close">&times;</button>
    <div id="energy-checkout-content">
      <!-- phase 1: select energy after -->
      <div id="checkout-select" class="checkout-phase">
        <p class="energy-question">Where's your energy now?</p>
        <div id="energy-checkout-levels" class="energy-levels">
          <!-- JS renders 5 levels -->
        </div>
        <button id="energy-checkout-done" class="energy-go-btn" disabled>Done</button>
      </div>
      <!-- phase 2: comparison -->
      <div id="checkout-compare" class="checkout-phase" style="display:none">
        <div class="compare-wrap">
          <div class="compare-col">
            <div class="compare-label">Before</div>
            <div id="compare-before-dot" class="compare-dot"></div>
            <div id="compare-before-text" class="compare-text"></div>
          </div>
          <div class="compare-arrow">â†’</div>
          <div class="compare-col">
            <div class="compare-label">After</div>
            <div id="compare-after-dot" class="compare-dot"></div>
            <div id="compare-after-text" class="compare-text"></div>
          </div>
        </div>
        <p id="checkout-message" class="checkout-message"></p>
        <button id="checkout-finish" class="energy-go-btn">Back to canvas</button>
      </div>
    </div>
  </div>
</div>

<!-- Screen: Parent Dashboard -->
<div id="screen-parent" class="screen">
  <div class="parent-header">
    <button id="parent-back" class="parent-back-btn" aria-label="Back">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <h2>Parent Dashboard</h2>
  </div>
  <div class="parent-body">
    <div id="parent-notification-config" class="parent-section">
      <h3>Notifications</h3>
      <div class="notif-row">
        <label for="telegram-url">Telegram Webhook URL</label>
        <input type="url" id="telegram-url" class="parent-input" placeholder="https://api.telegram.org/bot...">
        <button id="telegram-save" class="parent-save-btn">Save</button>
        <button id="telegram-test" class="parent-test-btn">Test</button>
      </div>
      <div id="telegram-status" class="notif-status"></div>
    </div>
    <div id="parent-profiles" class="parent-section">
      <!-- JS renders per-kid data here -->
    </div>
  </div>
</div>

<script src="app.js"></script>
<script>
// Service Worker Registration
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('sw.js').catch(function() {});
  });
}
</script>
</body>
</html>
